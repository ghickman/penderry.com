#!/usr/bin/env python

import glob
import json
import os

from jinja2 import Environment, FileSystemLoader


OUTPUT_DIR = os.path.join(os.getcwd(), 'output')
PAGE = 'index.html'


def build_painting(filename):
    name, ext = os.path.splitext(filename)
    data = {
        'alt': name,
        'name': filename,
    }
    return data

def load_json(filename):
    with open(filename) as json_data:
        return json.load(json_data)

paths = filter(lambda x: 'thumb' not in x, glob.iglob('img/tina_lewis_*.jpg'))
files = map(lambda x: os.path.split(x)[1], paths)
paintings = [build_painting(x) for x in files]

nav = load_json('constants/nav.json')
things_to_do = load_json('constants/things_to_do.json')

env = Environment(loader=FileSystemLoader('templates'))
page = env.get_template(PAGE)
with open(os.path.join(OUTPUT_DIR, PAGE), 'w') as f:
    f.write(page.render(nav=nav, paintings=paintings, things_to_do=things_to_do).encode('utf-8'))
