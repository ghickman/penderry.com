document.write('<link rel="stylesheet" href="http://gist.github.com/stylesheets/gist/embed.css"/>')





document.write('<div id=\"gist-355213\" class=\"gist\">\n  \n  \n    \n            \n\n      <div class=\"gist-file\">\n        <div class=\"gist-data gist-syntax\">\n          \n          \n          \n            <div class=\"gist-highlight\"><pre><div class=\"line\" id=\"LC1\"><span class=\"c\">#!/bin/sh<\/span><\/div><div class=\"line\" id=\"LC2\"><br/><\/div><div class=\"line\" id=\"LC3\"><span class=\"nb\">export <\/span><span class=\"nv\">PASSPHRASE<\/span><span class=\"o\">=<\/span>SomeMagiclySecurePassphrase<\/div><div class=\"line\" id=\"LC4\"><span class=\"nb\">export <\/span><span class=\"nv\">SSH_AUTH_SOCK<\/span><span class=\"o\">=<\/span>/tmp/ssh-agent<\/div><div class=\"line\" id=\"LC5\"><br/><\/div><div class=\"line\" id=\"LC6\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC7\"><span class=\"c\"># Dump mySQL databases, relying on backup of /var/lib/mysql isn&#39;t advised.<\/span><\/div><div class=\"line\" id=\"LC8\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC9\">mysqldump --all-databases -uroot -pTEHPAZZ | bzip2 -c &gt; /root/backups/db/all_databases_<span class=\"k\">$(<\/span>date +%Y_%m_%d<span class=\"k\">)<\/span>.sql.bz2<\/div><div class=\"line\" id=\"LC10\"><br/><\/div><div class=\"line\" id=\"LC11\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC12\"><span class=\"c\"># Main backup.<\/span><\/div><div class=\"line\" id=\"LC13\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC14\">duplicity --sign-key <span class=\"s1\">&#39;7F73FA36&#39;<\/span> --encrypt-key <span class=\"s1\">&#39;5FD0100F&#39;<\/span> --exclude-filelist<span class=\"o\">=<\/span>/root/scripts/backups/ignorelist / scp://rich@backup_server//mnt/backups/edge/main<\/div><div class=\"line\" id=\"LC15\"><br/><\/div><div class=\"line\" id=\"LC16\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC17\"><span class=\"c\"># Clean up.<\/span><\/div><div class=\"line\" id=\"LC18\"><span class=\"c\">#<\/span><\/div><div class=\"line\" id=\"LC19\"><br/><\/div><div class=\"line\" id=\"LC20\"><span class=\"c\"># Remove the temp database dump.<\/span><\/div><div class=\"line\" id=\"LC21\">rm /root/backups/db/all_databases_<span class=\"k\">$(<\/span>date +%Y_%m_%d<span class=\"k\">)<\/span>.sql.bz2<\/div><div class=\"line\" id=\"LC22\"><br/><\/div><div class=\"line\" id=\"LC23\"><span class=\"c\"># Delete duplicity backups older than 30 days.<\/span><\/div><div class=\"line\" id=\"LC24\">duplicity remove-older-than 30D scp://rich@backup_server//mnt/backups/edge/main<\/div><\/pre><\/div>\n          \n        <\/div>\n\n        <div class=\"gist-meta\">\n          <a href=\"http://gist.github.com/raw/355213/2694d42a61f6f93d6c93334220c4bbbfb2d67f09/backup.sh\" style=\"float:right;\">view raw<\/a>\n          <a href=\"http://gist.github.com/355213#file_backup.sh\" style=\"float:right;margin-right:10px;color:#666\">backup.sh<\/a>\n          <a href=\"http://gist.github.com/355213\">This Gist<\/a> brought to you by <a href=\"http://github.com\">GitHub<\/a>.\n        <\/div>\n      <\/div>\n    \n            \n            \n  \n<\/div>\n')
